<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />

  <title>BraVis Student Scholarship</title>

  <!-- 1) Librerías D3 -->
  <script src="https://d3js.org/d3.v7.min.js" defer></script>
  <script src="https://d3js.org/d3-geo.v3.min.js" defer></script>
  <script src="https://d3js.org/topojson.v3.min.js" defer></script>

  <!-- 2) Tus módulos -->
  <script src="js/map.js" defer></script>
  <script src="js/barChart.js" defer></script>
  <script src="js/pieCharts.js"    defer></script>
  
  <!-- 3) Orquestador principal -->
  <script src="js/main.js" defer></script>
</head>

<body>
  <div class="main-container">
    <h1>BraVis Student Scholarship</h1>

    <!-- Controles de selección -->
    <div class="controls">
      <div class="control-item">
        <label for="estado-selector">Seleccione un estado:</label>
        <select id="estado-selector">
          <option value="">--</option>
          <option value="AC">Acre</option>
          <option value="AL">Alagoas</option>
          <option value="AP">Amapá</option>
          <option value="AM">Amazonas</option>
          <option value="BA">Bahia</option>
          <option value="CE">Ceará</option>
          <option value="DF">Distrito Federal</option>
          <option value="ES">Espírito Santo</option>
          <option value="GO">Goiás</option>
          <option value="MA">Maranhão</option>
          <option value="MG">Minas Gerais</option>
          <option value="MS">Mato Grosso do Sul</option>
          <option value="MT">Mato Grosso</option>
          <option value="PA">Pará</option>
          <option value="PB">Paraíba</option>
          <option value="PE">Pernambuco</option>
          <option value="PI">Piauí</option>
          <option value="PR">Paraná</option>
          <option value="RJ">Rio de Janeiro</option>
          <option value="RN">Rio Grande do Norte</option>
          <option value="RO">Rondônia</option>
          <option value="RR">Roraima</option>
          <option value="RS">Rio Grande do Sul</option>
          <option value="SC">Santa Catarina</option>
          <option value="SE">Sergipe</option>
          <option value="SP">São Paulo</option>
          <option value="TO">Tocantins</option>
        </select>
      </div>

      <div class="control-item">
        <label for="year-selector">Seleccione año:</label>
        <select id="year-selector">
          <option value="2014">2014</option>
          <option value="2015">2015</option>
          <option value="2016">2016</option>
          <option value="2017">2017</option>
          <option value="2018">2018</option>
          <option value="2019">2019</option>
        </select>
      </div>

      <div class="control-item">
        <label for="category-selector">Seleccione categoría:</label>
        <select id="category-selector">
          <option value="NOME_TURNO_CURSO_BOLSA">Turno</option>
          <option value="TIPO_BOLSA">Tipo de Beca</option>
          <option value="SEXO_BENEFICIARIO_BOLSA">Género</option>
          <option value="RACA_BENEFICIARIO_BOLSA">Etnia</option>
        </select>
      </div>
    </div>

    <!-- Estado de carga -->
    <div id="loading-status" style="display: none; text-align: center; padding: 10px; margin: 15px 0; background-color: #f0f0f0; border-radius: 4px;">
      <span>Cargando datos...</span>
    </div>

    <!-- 1) Mapa de Brasil -->
    <div id="map-container" style="width: 100%; height: 400px; position: relative;">
      <div class="map-loading" style="text-align: center; padding: 150px 0;">
        <p>Cargando mapa de Brasil...</p>
      </div>
    </div>

    <!-- 2) Información del estado -->
    <div class="state-info">
      <h2>Estado: <span id="estado-nombre">Ninguno seleccionado</span></h2>
      <p>Total becas: <span id="total-becas">0</span></p>
      <div id="top-universidades">
        <h3>Top 5 universidades:</h3>
        <ul id="lista-universidades">
          <li>Seleccione un estado para ver información</li>
        </ul>
      </div>
    </div>

    <!-- 3) Gráficos -->
    <div class="charts-row">
      <!-- 3.1) Bar chart -->
      <div id="bar-chart-container">
        <h3>Porcentaje estudiantes por turno (Estado <span id="estado-barchart">Ninguno seleccionado</span>)</h3>
        <div id="bar-chart" style="width: 100%; height: 300px;">
          <div class="chart-placeholder" style="text-align:center; padding:100px 0;">
            Seleccione un estado para visualizar datos
          </div>
        </div>
      </div>

      <!-- 3.2) Pie charts -->
      <div id="pie-charts-container">
        <h3>Resumen otras categorías</h3>
        <div class="pie-charts">
          <div id="pie-chart1"><h4>Tipo de Beca</h4></div>
          <div id="pie-chart2"><h4>Género</h4></div>
          <div id="pie-chart3"><h4>Etnia</h4></div>
        </div>
      </div>
    </div>

    <!-- 4) Hand-drawn style chart -->
    <div id="hand-drawn-chart-container">
      <h3>Análisis Comparativo de Estudiantes</h3>
      <div id="hand-drawn-chart" style="width:100%; height:300px;">
        <div class="chart-placeholder" style="text-align:center; padding:150px 0;">
          Seleccione un estado para visualizar datos
        </div>
      </div>
    </div>

    <!-- Mensajes de estado / errores -->
    <div id="data-status" style="text-align:center; margin-top:20px; font-style:italic; color:#666;"></div>
  </div>

  <!-- Manejador global de errores y verificación de D3 -->
  <script>
    window.addEventListener('error', function(event) {
      console.error('Error capturado:', event.error);
      const msg = `
        <div style="color:#721c24; background-color:#f8d7da; border:1px solid #f5c6cb;
                    padding:10px; border-radius:4px;">
          <strong>Error en la aplicación:</strong> ${event.error.message}.
          <br/>Intente recargar la página o contacte al administrador.
        </div>`;
      document.getElementById('data-status').innerHTML = msg;
      return false;  // evita el mensaje por defecto del navegador
    });

    document.addEventListener('DOMContentLoaded', function() {
      if (typeof d3 === 'undefined') {
        document.getElementById('data-status').innerHTML = `
          <div style="color:#721c24; background-color:#f8d7da; border:1px solid #f5c6cb;
                      padding:10px; border-radius:4px;">
            <strong>Error:</strong> No se pudo cargar la biblioteca D3.js.
            <br/>Verifique su conexión e intente recargar.
          </div>`;
      }
    });
  </script>
</body>
</html>
